<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Editar Orçamento</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #fff;
            color: #000;
        }
        
        .container {
            margin-top: 50px;
        }
        
        h1 {
            color: #1A7B79;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .form-group label {
            color: #1A7B79;
            font-weight: bold;
        }
        
        .form-control {
            border: 1px solid #ccc;
            border-radius: 5px;
        }

    select {
        display: block;
        width: 100%;
        padding: .375rem 1.75rem .375rem .75rem;
        font-size: 1rem;
        line-height: 1.5;
        color: #495057;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #ced4da;
        border-radius: .25rem;
        transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
    }

    input[type="button"], .btn {
        background-color: #1A7B79;
        color: #fff;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
        font-size: 16px;
        margin: 5px;
    }
    input[type="button"]:hover, .btn-primary:hover, .btn-info:hover, .btn-secondary:hover {
        background-color: #13856b;
    }
    
    .btn-info {
        background-color: #17a2b8;
    }
    
    .btn-secondary {
        background-color: #6c757d;
    }

    @media (max-width: 768px) {
        .container {
            margin-top: 20px;
        }
    
        h1 {
            font-size: 24px;
        }
    
        .form-group {
            margin-bottom: 15px;
        }
    }

    fieldset {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 20px;
        margin-bottom: 20px;
    }

    legend {
        color: #1A7B79;
        font-weight: bold;
        padding: 0 10px;
        width: auto;
        border: none;
        font-size: 18px;
    }
</style>

</style>
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8 col-sm-10">
                <h1>Editar Orçamento</h1>
                <form id="editOrcamentoForm" action="/atualizar_orcamento" method="post">

            <!-- Informações de Entrega -->
            <div class="form-group">
                <label for="tipo">Tipo de Documento</label>
                <input type="text" class="form-control" id="tipo" name="tipo" value="{{ orcamento.tipo }}" required>
            </div>


            <!-- Número do Orçamento -->
            <div class="form-group">
                <label for="numero_orcamento">Número do Orçamento</label>
                <input type="text" class="form-control" id="numero_orcamento" name="numero_orcamento" value="{{ orcamento.numero_orcamento }}" required>
            </div>

            <!-- Data do Orçamento -->
            <div class="form-group">
                <label for="data_orcamento">Data do Orçamento</label>
                <input type="date" class="form-control" id="data_orcamento" name="data_orcamento" value="{{ orcamento.data_orcamento }}" required>
            </div>

            <!-- Quantidade de Produtos -->
            <div class="form-group">
                <label for="quantidade_produtos">Quantidade de Produtos</label>
                <input type="number" class="form-control" id="quantidade_produtos" name="quantidade_produtos" value="{{ orcamento.quantidade_produtos }}" required>
            </div>

            <!-- Informações da Empresa -->
            <div class="form-group">
                <label for="nome_empresa">Nome da Empresa</label>
                <input type="text" class="form-control" id="nome_empresa" name="nome_empresa" value="{{ orcamento.nome_empresa }}" required>
            </div>

            <!-- CNPJ -->
            <div class="form-group">
                <label for="cnpj">CNPJ</label>
                <input type="text" class="form-control" id="cnpj" name="cnpj" value="{{ orcamento.cnpj }}" required>
            </div>

            <!-- Telefone -->
            <div class="form-group">
                <label for="telefone">Telefone</label>
                <input type="text" class="form-control" id="telefone" name="telefone" value="{{ orcamento.telefone }}" required>
            </div>

            <!-- Email -->
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" class="form-control" id="email" name="email" value="{{ orcamento.email }}" required>
            </div>

            <!-- Endereço -->
            <div class="form-group">
                <label for="endereco">Endereço</label>
                <input type="text" class="form-control" id="endereco" name="endereco" value="{{ orcamento.endereco }}" required>
            </div>

            <!-- Informações Adicionais -->
            <div class="form-group">
                <label for="informacoesadicionais">Informações Adicionais</label>
                <textarea class="form-control" id="informacoesadicionais" name="informacoesadicionais" >{{ orcamento.informacoesadicionais }}</textarea>
            </div>

            <!-- Informações do Vendedor -->
            <div class="form-group">
                <label for="nomevendedor">Nome do Vendedor</label>
                <input type="text" class="form-control" id="nomevendedor" name="nomevendedor" value="{{ orcamento.nomevendedor }}" required>
            </div>

            <!-- Informações de Entrega -->
            <div class="form-group">
                <label for="frete">Tipo de Frete</label>
                <input type="text" class="form-control" id="frete" name="frete" value="{{ orcamento.frete }}" required>
            </div>

            <!-- Prazo de Entrega -->
            <div class="form-group">
                <label for="prazo_entrega">Prazo de Entrega</label>
                <input type="text" class="form-control" id="prazo_entrega" name="prazo_entrega" value="{{ orcamento.prazo_entrega }}" required>
            </div>
            
            <!-- Informações de Pagamento -->
            <label for="forma_pagamento">Forma de Pagamento:</label>
            <select id="forma_pagamento" name="forma_pagamento" onchange="atualizarFormaPagamento()">
                <option value="À vista">À vista</option>
                <option value="Parcelado">Parcelado</option>
            </select><br><br>

            <div id="produtosContainer"></div>
            <div id="detalhesPagamentoContainer"></div>

            <div class="form-group mt-3">
                <input type="button" value="Gerar PDF" class="btn btn-info" id="gerarPdfBtn">
                <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                <a href="/painel" class="btn btn-secondary mt-3">Voltar à Página Anterior</a>
            </div>
        </form>
    </div>
</div>
</div>

       
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const gerarPdfBtn = document.getElementById('gerarPdfBtn');
            gerarPdfBtn.addEventListener('click', function() {
                enviarDadosParaGerarPdf();
            });
        });
        
        function enviarDadosParaGerarPdf() {
            const formData = new FormData(document.getElementById('editOrcamentoForm'));
            // Aqui, você precisa chamar seu endpoint backend que gera o PDF
            fetch('/gerar_orcamento', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if(response.ok) {
                    return response.blob();
                } else {
                    throw new Error('Problema ao gerar PDF');
                }
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                window.open(url, '_blank');
            })
            .catch(error => console.error('Erro ao gerar PDF:', error));
        }
        
        function atualizarQuantidadeProdutos() {
            const quantidadeAtual = document.querySelectorAll('#produtosContainer fieldset').length;
            const novaQuantidade = parseInt(document.getElementById('quantidade_produtos').value);
        
            if (novaQuantidade > quantidadeAtual) {
                // Adicionar novos campos de produtos
                for (let i = quantidadeAtual; i < novaQuantidade; i++) {
                    adicionarCampoProduto(i);
                }
            } else if (novaQuantidade < quantidadeAtual) {
                // Remover campos de produtos extras
                for (let i = quantidadeAtual - 1; i >= novaQuantidade; i--) {
                    const produtoParaRemover = document.getElementById(`produto_${i}`);
                    if (produtoParaRemover) produtoParaRemover.remove();
                }
            }
        }
        
        // Adicione um event listener ao campo de quantidade de produtos
        document.getElementById('quantidade_produtos').addEventListener('change', atualizarQuantidadeProdutos);
        
        function carregarProdutos(orcamentoId) {
            fetch(`/get_produtos/${orcamentoId}`, { method: 'GET' })
            .then(response => response.json())
            .then(produtos => {
                const produtosDiv = document.getElementById('produtosContainer');
                produtos.forEach((produto, index) => {
                    produtosDiv.innerHTML += `
                        <fieldset>
                            <legend>Produto ${index + 1}</legend>
                            <!-- Campos do produto -->
                            <!-- ... -->
                        </fieldset>
                    `;
                });
            })
            .catch(error => console.error('Erro ao carregar produtos:', error));
        }
        

        function atualizarFormaPagamento() {
            const formaPagamento = document.getElementById('forma_pagamento').value;
            const detalhesPagamentoDiv = document.getElementById('detalhesPagamentoContainer');

            if (formaPagamento === 'Parcelado') {
                detalhesPagamentoDiv.innerHTML = `
                    <label for="num_parcelas">Número de Parcelas:</label>
                    <input type="number" id="num_parcelas" name="num_parcelas" min="1" value="{{ orcamento.num_parcelas }}" ><br><br>


                    <label for="entrada">Entrada:</label>
                    <input type="number" id="entrada" name="entrada" step="0.01"  value="{{ orcamento.entrada }}" ><br><br>

                    
                `;
            } else {
                detalhesPagamentoDiv.innerHTML = '';
            }
        }

        // Inicializar campos
        window.onload = function() {
            const quantidadeProdutos = document.getElementById('quantidade_produtos').value || 0;
            gerarCamposProdutos(quantidadeProdutos);
            atualizarFormaPagamento();
        };
    </script>
</body>
</html>
        

    <script src="{{ url_for('static', filename='editar_orcamento.js') }}"></script>
</body>
</html>